<img src="logo.png" width:100px>

# SigmaCCS2

This is the code repo for the paper *SigmaCCS2: Collision Cross Section Prediction Using Molecular Topology and Geometry Information With Graph Neural Network*. We developed SigmaCCS2, which uses molecular and line graphs combined with Graph Neural Network to explicitly capture molecular topological and geometric information for CCS prediction. It is an improved version of SigmaCCS.

## Installation
**1.** Install [Anaconda](https://www.anaconda.com) for python 3.12.3.

**2.** Create environment and install the required packages.

- Open command line and create environment.
	```shell
  conda create --name SigmaCCS2 python=3.12.3
  conda activate SigmaCCS2
	```
- Clone the repository and enter.
	```shell
  git clone https://github.com/yuxuanliao/SigmaCCS2.git
  cd SigmaCCS2
	```
- Install the required packages in [`requirements/pip/requirements.txt`](requirements/pip/requirements.txt) with following commands.
  ```shell
  python -m pip install -r requirements/pip/requirements.txt
	```
- Or install the required packages by using the [`requirements/conda/environment.yaml`](requirements/conda/environment.yaml) with following commands.
  ```shell
  conda env create -f requirements/conda/environment.yaml
	```

## SigmaCCS2
The following files are in the [SigmaCCS2](SigmaCCS2) folder:
- [DataConstruction.py](SigmaCCS2/DataConstruction.py). for converting SMILES strings to molecular graph and line graph and using one-hot encoding to encode the adduct ion type.
- [ModelTraining.py](SigmaCCS2/ModelTraining.py). for model training.
- [ModelPrediction.py](SigmaCCS2/ModelPrediction.py). for defining the evaluation metrics and predicting the CCS values by SigmaCCS2.
- [Parameter.py](SigmaCCS2/Parameter.py). for saving relevant parameters including atom radius, atom mass, adduct set, and atoms set.

## Model training
Train the model based on your own training dataset with [SigmaCCS2_train](https://github.com/yuxuanliao/SigmaCCS2/blob/main/SigmaCCS2/ModelTraining.py#L65) function.
    
    SigmaCCS2_train(ifilepath, epochs, batchsize, savepath)

*Parameters*
- ifilepath : file path for storing the dataset to train the model
- epochs : the hyperparameter of the model
- batchsize : the hyperparameter of the model
- savepath : file path where the model is saved

## CCS Prediction
The CCS values of molecules is predicted by using the already trained SigmaCCS2 model with [SigmaCCS2_predict](https://github.com/yuxuanliao/SigmaCCS2/blob/main/SigmaCCS2/SigmaCCS2_predict.py#L37) function.

    SigmaCCS2_predict(ifilepath, mfilepath, ofilepath)

*Parameters*
- ifilepath : file path for storing the data of smiles and adduct, which needs to predict CCS values
- mfilepath : file path where the model is stored
- ofilepath : file path to save the predicted CCS values

## Usage
The example code for model training is included in the [train.ipynb](train.ipynb). By directly running [train.ipynb](train.ipynb), user can train the model based on your own training dataset.

The example code for CCS prediction is included in the [predict.ipynb](predict.ipynb). By directly running [predict.ipynb](predict.ipynb), user can use SigmaCCS2 to predict CCS values of small molecules.

The example code details the complete pipeline for METLIN with step-by-step instructions, which is included in the [complete pipeline for METLIN.ipynb](complete%20pipeline%20for%20METLIN.ipynb). By directly running [complete pipeline for METLIN.ipynb](complete%20pipeline%20for%20METLIN.ipynb), user can directly preprocess raw data files, run predictions, generate final comparative performance metrics and scatter plot.

## data and model
- [data](data) folder:
    - *[ExternalTestSet.csv](data/ExternalTestSet.csv)* (the external test set is used to evaluate the SigmaCCS2 approach)
    - *[ExternalTestSet-Prediction.csv](data/ExternalTestSet-Prediction.csv)* (the file generated by running [predict.ipynb](predict.ipynb))
    - *[TrainingSet.csv](data/TrainingSet.csv)* (the training set is used to train the model)
    - *[Combined dataset.csv](data/Combined%20dataset.csv)* (the combined dataset that integrates both the METLIN-CCS and SigmaCCS2 datasets)
    - *[METLIN_IMS_all plot CV %3C2% _dimers_rmTM .csv](data/METLIN_IMS_all%20plot%20CV%20%3C2%%20_dimers_rmTM%20.csv)* (the downloaded raw data file for the METLIN-CCS)
    - *[METLIN-CCS dataset.csv](data/METLIN-CCS%20dataset.csv)* (the final METLIN-CCS database after preprocessing)    
    - *[METLIN-CCS dataset-Prediction.csv](data/METLIN-CCS%20dataset-Prediction.csv)* (the file generated by running [complete pipeline for METLIN.ipynb](complete%20pipeline%20for%20METLIN.ipynb))
    - *[Phycotoxin dataset.csv](results/Phycotoxin%20dataset.csv)* (the phycotoxin dataset is used to evaluate the SigmaCCS2 approach)
    - *[Mycotoxin dataset.csv](results/Mycotoxin%20dataset.csv)* (the mycotoxin dataset is used to evaluate the SigmaCCS2 approach)    
    - *[Human metabolome dataset.csv](results/Human%20metabolome%20dataset.csv)* (the human metabolome dataset is used to evaluate the SigmaCCS2 approach) 

- [model](model) folder:
    - *[model.pt](model/model.pt)* (the optimized model)
    - *[model_METLIN.pt](model/model_METLIN.pt)* (the model trained exclusively on the METLIN-CCS dataset)
    - *[model_Combined.pt](model/model_Combined.pt)* (the model trained on the combined dataset integrating both the METLIN-CCS and SigmaCCS2 datasets)

## Predictions from all compared models
- [results](results) folder:
    - *[External test set1_prediction.csv](results/External%20test%20set1_prediction.csv)* (the predictions generated by different models on the external test set 1)
    - *[Phycotoxin dataset_prediction.csv](results/Phycotoxin%20dataset_prediction.csv)* (the predictions generated by different models on the phycotoxin dataset)
    - *[Mycotoxin dataset_prediction.csv](results/Mycotoxin%20dataset_prediction.csv)* (the predictions generated by different models on the mycotoxin dataset)    
    - *[Human metabolome dataset_prediction.csv](results/Human%20metabolome%20dataset_prediction.csv)* (the predictions generated by different models on the human metabolome dataset) 
    - *[METLIN-CCS dataset_prediction.csv](results/METLIN-CCS%20dataset_prediction.csv)* (the predictions generated by different models on the METLIN-CCS dataset) 

## Web server
SigmaCCS2 is readily accessible via a web interface (https://huggingface.co/spaces/yuxuanliao/SigmaCCS2), which supports users in predicting the CCS values of molecules directly.

## Information of maintainers
- 232303012@csu.edu.cn
